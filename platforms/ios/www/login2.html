<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<link rel="apple-touch-icon" href="images/apple-touch-icon.png" />
<link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" href="apple-touch-startup-image-640x1096.png">
<title>Fun Pass Orlando</title>
<link rel="stylesheet" href="css/framework7.css">
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="css/colors/funpass-blue.css">
<link type="text/css" rel="stylesheet" href="css/swipebox.css" />
<link type="text/css" rel="stylesheet" href="css/animations.css" />
<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,700,900' rel='stylesheet' type='text/css'>

<link rel="stylesheet" type="text/css" href="css/sweetalert.css">
<script src="js/sweetalert.min.js"></script> 
</head>
<body id="mobile_wrap">

    <div class="statusbar-overlay"></div>

    <div class="panel-overlay"></div>

    <div class="pages">
    <div data-page="login" class="page no-toolbar">
        <div class="page-content">
          <div class="navbarpages">
        <div class="nav_left_logo">
          <a href="index.html"><img src="images/logo-white.png" alt="" title="" /></a>
        </div>
      </div>
      <div class="login-box">
        <div class="lb-header">
          <a href="#tab1" class="tab-link active" id="login-box-link">Login</a>
          <a href="#tab2" class="tab-link" id="signup-box-link">Cadastro</a>
        </div>
        <div class="social-login">
          <div class="u-form-group" style="text-align:center">
              <button type="button" id="login_fb" class="btn-facebook">
                <i class="fa fa-facebook fa-lg"></i>
                Login facebook
              </button>
          </div>
        </div>
            <div class="tabs-animated-wrap">
                  <div class="tabs">
                      <div id="tab1" class="tab active">
                          <form class="email-login">
                            <div class="u-form-group">
                              <input type="text" name="user_email" placeholder="Email"/>
                            </div>
                            <div class="u-form-group">
                              <input type="password" name="user_pass" placeholder="Senha"/>
                            </div>
                            <div class="u-form-group">
                              <button type="button" id="login">Acessar</button>
                            </div>
                            <!-- <div class="u-form-group">
                              <a href="#" class="forgot-password">Esqueceu a senha?</a>
                            </div> -->
                          </form>
                            </div>
                            <div id="tab2" class="tab">
                          <form class="email-signup">
                                <div class="u-form-group">
                              <input type="text" name="user_login" placeholder="Nome" class="required" />
                            </div>
                            <div class="u-form-group">
                              <input type="email" name="user_email" placeholder="Email" class="required" />
                            </div>
                            <div class="u-form-group">
                              <input type="password" name="pass1" placeholder="Senha" class="required" />
                            </div>
                            <div class="u-form-group">
                              <input type="password" name="pass2" placeholder="Confirmar Senha" class="required" />
                            </div>
                            <div class="u-form-group">
                              <button type="button" id="register_submit">Cadastrar</button>
                            </div>
                          </form>
                      </div>
                  </div>
              </div>
      </div>
        </div>
    </div>


    <div id="load" style="display: none">
        <div class="container_load">
          <div class="ball"></div>
          <div class="ball"></div>
          <div class="ball"></div>
          <div class="ball"></div>
        </div>
    </div>
</div>
    <script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
    <script src="js/jquery.validate.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/framework7.js"></script>
    <script type="text/javascript" src="js/my-app.js"></script>
    <script type="text/javascript" src="js/jquery.swipebox.js"></script>
    <script type="text/javascript" src="js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="js/email.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/facebookConnectPlugin.js"></script>
  <script type="text/javascript">

    $('#login_fb').on('click',function(e){
        $('#load').css('display', 'block');
        if (!window.cordova) {
            facebookConnectPlugin.browserInit('944331018956311');
        }

        facebookConnectPlugin.login( ["public_profile", "email"],
            function (response) {
                $.ajax({
                    type: 'post',
                    data: {userID: response.authResponse.userID, accessToken: response.authResponse.accessToken},
                    method: 'post',
                    url: 'http://beta.funpassorlando.com/api/public/index.php/user/fb',
                    crossDomain: true, // enable this
                    dataType: 'json',
                    success: function(data){
                        if (data.status == 'error') {
                            sweetAlert("Oops...", "Não foi possível finalizar seu cadastro!", "error");
                        } else {
                            window.localStorage.setItem('card_number', data.card_number);
                            window.localStorage.setItem('qr_code', data.qr_code);
                            window.localStorage.setItem('user_email', data.user_email);
                            window.localStorage.setItem('user_name', data.user_name);
                            window.localStorage.setItem('user_profile', data.user_profile);

                            window.location.href = './index.html';
                        }
                        $('#login').removeAttr("disabled");

                    }
                });
            },
            function (response) { 
                sweetAlert("Oops...", "Algo deu errado!", "error"); 
            });
            $('#load').css('display', 'none');
    });

    $('#login').on('click',function(e){
        $('#login').attr("disabled", "disabled");
        $('#load').css('display', 'block');
        e.preventDefault();
        var postData = $('.email-login').serialize();

        $.ajax({
            type: 'post',
            data: postData,
            method: 'post',
            url: 'http://beta.funpassorlando.com/api/public/index.php/user/get',
            crossDomain: true, // enable this
            dataType: 'json',
            success: function(data){
                if (data.status == 'error') {
                    sweetAlert("Oops...", "Usuário ou login incorretos!", "error");
                } else {
                    window.localStorage.setItem('card_number', data.card_number);
                    window.localStorage.setItem('qr_code', data.qr_code);
                    window.localStorage.setItem('user_email', data.user_email);
                    window.localStorage.setItem('user_name', data.user_name);

                    window.location.href = './index.html';
                }
                $('#load').css('display', 'none');
                $('#login').removeAttr("disabled");

            }
                //beforeSend: setHeader
        });

        return false;
    });

    $('#register_submit').on('click',function(e){
        if ($('.required').val() != '') {
            $('#login').attr("disabled", "disabled");
            $('#load').css('display', 'block');
            e.preventDefault();
            var postData = $('.email-signup').serialize();

            $.ajax({
                type: 'post',
                data: postData,
                method: 'post',
                url: 'http://beta.funpassorlando.com/api/public/index.php/user/register',
                crossDomain: true, // enable this
                dataType: 'json',
                success: function(data){
                    if (data.status == 'error') {
                        sweetAlert("Oops...", "Não foi possível cadastrar!", "error");
                    } else {
                        window.localStorage.setItem('card_number', data.card_number);
                        window.localStorage.setItem('qr_code', data.qr_code);
                        window.localStorage.setItem('user_email', data.user_email);
                        window.localStorage.setItem('user_name', data.user_name);

                        window.location.href = './index.html';
                    }
                    $('#load').css('display', 'none');
                    $('#login').removeAttr("disabled");
                }
            });
            return false;
        } else {
          sweetAlert("Oops...", "Todos os campos devem ser preenchidos!", "error");
        }
    });

  </script>
</body>
</html>